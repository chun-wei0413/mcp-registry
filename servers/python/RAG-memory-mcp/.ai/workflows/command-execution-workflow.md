# Command Execution Workflow

## 目的
提供標準化的命令執行模式，讓 AI 能理解和執行各種結構化指令。

## 通用命令格式

### 1. 參考執行模式
```
參考 [source], [action] to [target]
```
範例：
- `參考 requirements.txt, 安裝依賴到專案`
- `參考 API 規格, 生成 TypeScript 類型定義`

### 2. 基於規格生成
```
根據 [specification] 產生 [output-type]
```
範例：
- `根據 user-story.md 產生測試案例`
- `根據 database-schema.sql 產生 ORM 模型`

### 3. 執行任務
```
執行 [task-description]
```
範例：
- `執行程式碼品質檢查`
- `執行資料庫遷移`

### 4. 分析專案
```
分析 [target] 的 [aspect]
```
範例：
- `分析專案的依賴關係`
- `分析程式碼的複雜度`

## 命令處理流程

1. **解析階段**
   - 識別命令類型
   - 提取參數
   - 驗證參數有效性

2. **準備階段**
   - 檢查必要條件
   - 載入相關資源
   - 確認執行權限

3. **執行階段**
   - 執行具體操作
   - 記錄執行過程
   - 處理異常情況

4. **回報階段**
   - 總結執行結果
   - 記錄到適當位置
   - 提供後續建議

## 命令類別

### 依賴管理命令
- 安裝依賴
- 更新依賴版本
- 檢查依賴安全性
- 移除未使用依賴

### 程式碼生成命令
- 從規格生成程式碼
- 從範例生成樣板
- 從資料生成模型
- 從測試生成實作

### 專案操作命令
- 初始化專案結構
- 執行建置流程
- 執行測試套件
- 部署應用程式

### 分析報告命令
- 程式碼品質分析
- 效能分析
- 安全性掃描
- 相依性分析

## 與 Tech Stacks 整合

不同技術棧可以定義專屬命令：

### JavaScript/Node.js
```
參考 package.json, 執行 npm scripts
```

### Python
```
參考 requirements.txt, 建立虛擬環境並安裝依賴
```

### Java/Maven
```
參考 pom.xml, 執行 Maven 生命週期
```

## 命令記錄

執行的命令應記錄到：
```
.ai/
└── command-history/
    └── YYYY-MM-DD.md
```

格式：
```markdown
## [時間戳記]
**命令**: [執行的命令]
**結果**: [成功/失敗]
**輸出**: [主要輸出摘要]
**副作用**: [產生或修改的檔案]
```

## 安全考量

1. **權限控制**
   - 不執行破壞性操作除非明確授權
   - 不修改關鍵系統檔案
   - 不執行未知來源的腳本

2. **驗證檢查**
   - 驗證輸入參數
   - 檢查檔案存在性
   - 確認操作可逆性

3. **備份機制**
   - 重要操作前自動備份
   - 提供復原選項
   - 記錄變更歷史

## 錯誤處理

1. **常見錯誤**
   - 檔案不存在
   - 權限不足
   - 依賴缺失
   - 網路問題

2. **錯誤回應**
   - 清楚說明錯誤原因
   - 提供解決建議
   - 詢問是否重試

## 使用範例

```bash
# 通用依賴安裝
參考 dependencies.txt, 安裝所有依賴

# 程式碼生成
根據 api-spec.yaml 產生 REST API 實作

# 專案分析
分析專案結構並產生架構文檔

# 批次執行
執行以下命令：
1. 執行測試
2. 檢查程式碼品質
3. 產生覆蓋率報告
```